---
title: 'Error Bars and Misconceptions'
output:
  html_document:
    keep_md: yes
---

# Error Bars and Misconceptions

```{r load libraries}
library(dplyr)
library(ggplot2)
set.seed(123) # random seed for reproducibility
```


## Misconceptions

- **Misinterpretation of Error Bars**: Error bars are frequently misunderstood in terms of what they signify about statistical significance, particularly when comparing the overlap of error bars from different data sets.

- **Confusing SD with SEM**: There is often a mix-up between standard deviation (SD) and standard error of the mean (SEM). SD error bars tell about the variability within the population, whereas SEM bars inform about the uncertainty of the estimated mean, which is influenced by sample size.

- **Misconception about Confidence Intervals**: A common error is the belief that a 95% confidence interval (CI) indicates that there is a 95% probability that the interval contains the true population mean, which is a misinterpretation of how confidence intervals function statistically.

```{r generate population statistics}
population <- rnorm(100000, mean = 3, sd = 0.5)
one_sample <- sample(population, 100)

# Calculate statistics
stats <- tibble(
  mean = mean(one_sample),
  sd = sd(one_sample),
  n = length(one_sample),
  se = sd / sqrt(n),
  ci80_lower = mean + qt(0.10, n-1) * se,
  ci80_upper = mean + qt(0.90, n-1) * se,
  ci95_lower = mean + qt(0.025, n-1) * se,
  ci95_upper = mean + qt(0.975, n-1) * se,
  ci99_lower = mean + qt(0.005, n-1) * se,
  ci99_upper = mean + qt(0.995, n-1) * se
)

# Create plot data in a clear way
plot_data <- tibble(
  type = c("Raw Data", "±SD", "±SE", "80% CI", "95% CI", "99% CI"),
  x = 1:6,
  y = c(NA, rep(stats$mean, 5)),  # NA for raw data (will use geom_jitter)
  ymin = c(NA, 
           stats$mean - stats$sd,
           stats$mean - stats$se,
           stats$ci80_lower,
           stats$ci95_lower,
           stats$ci99_lower),
  ymax = c(NA,
           stats$mean + stats$sd,
           stats$mean + stats$se,
           stats$ci80_upper,
           stats$ci95_upper,
           stats$ci99_upper)
)
```


```{r plot}
# Plot
ggplot() +
  # Raw data (only at x=1)
  geom_jitter(data = tibble(x = 1, y = one_sample),
              aes(x = x, y = y),
              width = 0.2, alpha = 0.5, color = "gray60") +
  
  # Error bars (x=2 through 6)
  geom_point(data = filter(plot_data, !is.na(y)),
             aes(x = x, y = y, color = type),
             size = 3) +
  geom_errorbar(data = filter(plot_data, !is.na(y)),
                aes(x = x, y = y, ymin = ymin, ymax = ymax, color = type),
                width = 0.2, linewidth = 1) +
  
  scale_x_continuous(breaks = 1:6,
                     labels = c("Raw\nData", "±SD", "±SE", 
                               "80% CI", "95% CI", "99% CI")) +
  
  labs(title = "Different Ways to Show Uncertainty",
       subtitle = paste0("n = ", stats$n, ", mean = ", round(stats$mean, 2)),
       x = "",
       y = "Rating") +
  
  theme_minimal() +
  theme(legend.position = "none")

```

## What each type of error represents

**Sample Mean** (̄$\bar{x}$): ` r round(stats$mean,3)`
Our best estimate of the population mean
One number from our one sample

**Standard Deviation (SD)**: `r round(stats$sd, 3)`
Describes variability in the population
Answers: "How spread out are individual ratings?"
Not about sampling uncertainty

**Standard Error (SE)**: `r round(stats$se, 3)`
Describes uncertainty about the mean
Answers: "If I repeated this study, how much would the mean vary?"
This is about the sampling distribution
Formula: $SE = \frac{SD}{\sqrt{n}}$

**Confidence Intervals (CI)**:
95% CI: $\pm$ (`r round(stats$ci95_lower, 3)`,`r round(stats$ci95_upper, 3)`) 
Answers: "If we repeated this study many times and calculated a 95% CI each time, 95% of those intervals would contain"
Formula: $\bar{x} \pm t^{*} \cdot SE$
Also about the sampling distribution

```{r}
mean1 <- 5
mean2 <- 4
n <- 10
alpha <- 0.05


t_critical <- qt(1 - alpha/2, df=(n-1)*2)  

std_dev_estimated <- abs(mean1 - mean2) / t_critical * sqrt(n/2)

sem1 <- std_dev_estimated / sqrt(n)
sem2 <- std_dev_estimated / sqrt(n)
ci_half_width1 <- t_critical * sem1
ci_half_width2 <- t_critical * sem2


data <- data.frame(
  type = rep(c('STD', 'SEM', 'CI'), each = 2),
  sample = factor(rep(c('Sample 1', 'Sample 2'), 3)),
  mean = c(mean1, mean2, mean1, mean2, mean1, mean2),
  ymin = c(mean1 - std_dev_estimated, mean2 - std_dev_estimated,
           mean1 - sem1, mean2 - sem2,
           mean1 - ci_half_width1, mean2 - ci_half_width2),
  ymax = c(mean1 + std_dev_estimated, mean2 + std_dev_estimated,
           mean1 + sem1, mean2 + sem2,
           mean1 + ci_half_width1, mean2 + ci_half_width2)
)


ggplot(data, aes(x = type, y = mean, fill = sample)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
  geom_errorbar(aes(ymin = ymin, ymax = ymax), position = position_dodge(width = 0.8), width = 0.25) +
  theme_minimal() +
  labs(title = "Grouped by Error Types with P-value = 0.05", y = "Mean Value") +
  scale_fill_brewer(palette = "Pastel1", name = "Sample")
```
## Guidance on Using SD, SE, and CI as Errors When Plotting Data

1. Standard Deviation (SD):
   - Use SD to represent the variability or dispersion of a set of data points around the mean.
   - SD is most appropriate when you want to show how much individual measurements in a dataset vary from the average value.
   - Ideal for datasets where you're interested in the distribution of values itself, rather than estimating the reliability of a sample mean.

2. Standard Error (SE):
   - Use SE to represent the precision of the sample mean as an estimate of the population mean.
   - SE is calculated as the standard deviation of the sample divided by the square root of the sample size.
   - Appropriate for datasets where the goal is to infer about the population from a sample, especially in cases where multiple samples are compared.

3. Confidence Intervals (CI):
   - Use CIs to provide a range within which the true population parameter is expected to lie, with a certain level of confidence (usually 95% or 99%).
   - CI gives an estimated range of values which is likely to include the population parameter, based on the sample data.
   - Ideal for both visualizing the precision of sample estimates and making inferences about the population, particularly useful in comparative studies.

## Important Points:

::: {style="padding: 15px; margin-bottom: 20px; border: 2px solid #3498db; border-radius: 5px; background-color: #ecf0f1;"}
**Take Home**
- SD emphasizes the variability or spread of the data.
- SE provides a measure of the accuracy of the sample mean.
- CI offers an estimated range that is likely to include the population parameter, indicating the reliability of an estimate.
:::

## Considerations:

- When plotting data with errors, your choice among SD, SE, and CI should align with the story you want the data to tell. Are you focusing on the spread of the data, the precision of the sample mean, or the range within which the population mean likely falls?
- The use of SE and CI is particularly relevant in hypothesis testing and when the sample size is relatively small compared to the population.
- Always specify what measure of error you are using in your plots to avoid misinterpretation.


## Reference

- Krzywinski, M., & Altman, N. (2013). Error bars. Nature Methods, 10(10), 921-922. https://doi.org/10.1038/nmeth.2659